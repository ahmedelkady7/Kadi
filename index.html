<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>البث المباشر</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
</head>
<body>

    <!-- الشريط العلوي -->
    <header>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="ابحث عن قناة..." onkeyup="filterChannels()">
        </div>
        <div class="icons">
            <img src="notification-icon.png" alt="إشعارات" onclick="goToNotifications()">
            <img src="profile.jpg" alt="حسابي" class="profile-pic" onclick="goToAccount()">
        </div>
    </header>

    <!-- شريط الفئات -->
    <nav class="categories">
        <button onclick="filterCategory('all')">الكل</button>
        <button onclick="filterCategory('news')">أخبار</button>
        <button onclick="filterCategory('sports')">رياضة</button>
        <button onclick="filterCategory('movies')">أحدث الأفلام</button>
    </nav>

    <!-- قسم القنوات المباشرة -->
    <section class="live-tv">
        <h2>Live TV Channels</h2>
        <div id="channelsList" class="horizontal-list"></div>
    </section>

    <!-- قسم الأفلام -->
    <section class="movies">
        <h2>أحدث الأفلام</h2>
        <div id="moviesList" class="movie-slider"></div>
    </section>

    <script>
        // تكوين Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAI21TvGX8jjTbEIDww5GEKcxM9zL6Gkn8",
            authDomain: "ak-sport-a985e.firebaseapp.com",
            databaseURL: "https://ak-sport-a985e-default-rtdb.firebaseio.com",
            projectId: "ak-sport-a985e",
            storageBucket: "ak-sport-a985e.appspot.com",
            messagingSenderId: "922662521404",
            appId: "1:922662521404:web:be257019ae9c69f6ddd139"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // جلب بيانات القنوات المباشرة
        function loadChannels() {
            db.ref("ak_tv_2").once("value", (snapshot) => {
                let channels = snapshot.val();
                let list = document.getElementById("channelsList");
                list.innerHTML = "";
                for (let key in channels) {
                    let channel = channels[key];
                    let item = `<div class="channel-card" onclick="watchChannel('${channel.link}')">
                                    <img src="${channel.img}" alt="${channel.name}">
                                    <p>${channel.name}</p>
                                </div>`;
                    list.innerHTML += item;
                }
            });
        }

        // جلب بيانات الأفلام بترتيب تصاعدي حسب عدد المشاهدات
        function loadMovies() {
            db.ref("film").orderByChild("view").once("value", (snapshot) => {
                let movies = snapshot.val();
                let list = document.getElementById("moviesList");
                list.innerHTML = "";
                for (let key in movies) {
                    let movie = movies[key];
                    let item = `<div class="movie-card" onclick="goToEpisode('${movie.id}')">
                                    <img src="${movie.cover}" alt="${movie.name}">
                                    <p>${movie.name}</p>
                                </div>`;
                    list.innerHTML += item;
                }
            });
        }

        // البحث عن القنوات
        function filterChannels() {
            let input = document.getElementById("searchInput").value.toLowerCase();
            let channels = document.getElementsByClassName("channel-card");
            for (let channel of channels) {
                let name = channel.getElementsByTagName("p")[0].innerText.toLowerCase();
                channel.style.display = name.includes(input) ? "block" : "none";
            }
        }

        // تصفية القنوات حسب الفئة
        function filterCategory(category) {
            let channels = document.getElementsByClassName("channel-card");
            for (let channel of channels) {
                channel.style.display = (category === 'all' || channel.dataset.category === category) ? "block" : "none";
            }
        }

        // التوجيه إلى صفحة الإشعارات
        function goToNotifications() {
            window.location.href = "notifications.html";
        }

        // التوجيه إلى صفحة الحساب
        function goToAccount() {
            window.location.href = "account.html";
        }

        // التوجيه إلى صفحة الحلقة
        function goToEpisode(id) {
            window.location.href = `episode.html?id=${id}`;
        }

        // فتح البث المباشر للقناة
        function watchChannel(link) {
            window.open(link, "_blank");
        }

        // تحميل البيانات عند تشغيل الصفحة
        window.onload = function () {
            loadChannels();
            loadMovies();
        };
    </script>
</body>
</html>
